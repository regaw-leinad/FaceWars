<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>sandbox</title>
	<style type="text/css" media="screen">
		.point {
			width: 0;
			height: 0;
			position: absolute;
			top: 50%;
			left: 50%;
		}
		.ship {
			width: 50px;
			height: 50px;
			position: absolute;
			z-index: 10;
			top: 50%;
			left: 50%;
			margin-top: -25px;
			margin-left: -25px;
			border-radius: 100px;
		}
	</style>
</head>
<body>

<script type="text/javascript">



	function RGBA() {
		this.r = this.getRandom255();
		this.g = this.getRandom255();
		this.b = this.getRandom255();
		this.a = 0.6;
	}

	RGBA.prototype.getRandom255 = function () {
		return Math.round(Math.random() * 255);
	};

	RGBA.prototype.toString = function () {
		return 'rgba(' +
			this.r + ', ' +
			this.g + ', ' +
			this.b + ', ' +
			this.a + ')';
	};



	function Ship() {
		this.color = new RGBA();
		this.x = window.innerWidth / 2;
		this.y = window.innerWidth / 2;
		this.el = {};
		this.el.point = document.createElement('div');
		this.el.point.setAttribute('class', 'point');
		this.el.ship = document.createElement('div');
		this.el.ship.setAttribute('class', 'ship');
		this.el.point.appendChild(this.el.ship);
		document.body.appendChild(this.el.point);
		this.draw();
	}

	Ship.prototype.draw = function () {
		this.el.point.style.left = this.x + 'px';
		this.el.point.style.top = this.y + 'px';
		this.el.ship.style.backgroundColor = this.color.toString();
	};

	Ship.prototype.moveX = function(dx) {
		this.x += dx;
		this.draw();
	};

	Ship.prototype.moveY = function(dy) {
		this.y += dy;
		this.draw();
	};

	Ship.prototype.setColor = function(rgba) {
		this.color = rgba;
		this.draw();
	};



	var ship = new Ship();








	var Keys = (function () {
		// state maps { keyCode: boolean }
		var keyIsDown = {};
		var keyIsPressed = {};
		var keyPressLimbo = {};
		// handle key down
		window.addEventListener('keydown', function (e) {
			var key = e.keyCode || e.which;
			keyIsDown[key] = true;
			if (!keyPressLimbo[key]) {
				keyIsPressed[key] = true;
				keyPressLimbo[key] = true;
			}
		});
		// handle key up
		window.addEventListener('keyup', function (e) {
			var key = e.keyCode || e.which;
			if (keyIsDown[key]) {
				delete keyIsDown[key];
			}
			if (keyPressLimbo[key]) {
				delete keyPressLimbo[key];
			}
		});
		// public interface
		return {
			// update on frame
			update: function () {
				/*
				Object.keys(keyIsDown).forEach(function (keyCode) {
					console.log('downed keyCode = ' + keyCode);
				});
				Object.keys(keyIsPressed).forEach(function (keyCode) {
					console.log('pressed keyCode = ' + keyCode);
				});
				*/
				// reset presses
				keyIsPressed = {};
			},
			// state check methods
			isDown: function (keyCode) {
				return keyIsDown[keyCode];
			},
			isPressed: function (keyCode) {
				if (keyIsPressed[keyCode]) {
					delete keyIsPressed[keyCode];
					return true;
				} else {
					return false;
				}
			},
			// keycodes
			SPACEBAR: 32,
			LEFT: 37,
			UP: 38,
			RIGHT: 39,
			DOWN: 40
		};
	})();




	function handleMovement(dtime) {
		var speed = 10;
		var slowdown = 3 / 4;
		// up left
		if (Keys.isDown(Keys.UP) && Keys.isDown(Keys.LEFT)) {
			speed = speed * slowdown;
			ship.moveX(-speed);
			ship.moveY(-speed);
		}
		// up right
		else if (Keys.isDown(Keys.UP) && Keys.isDown(Keys.RIGHT)) {
			speed = speed * slowdown;
			ship.moveX(speed);
			ship.moveY(-speed);
		}
		// down left
		else if (Keys.isDown(Keys.DOWN) && Keys.isDown(Keys.LEFT)) {
			speed = speed * slowdown;
			ship.moveX(-speed);
			ship.moveY(speed);
		}
		// down right
		else if (Keys.isDown(Keys.DOWN) && Keys.isDown(Keys.RIGHT)) {
			speed = speed * slowdown;
			ship.moveX(speed);
			ship.moveY(speed);
		}
		else {
			// left
			if (Keys.isDown(Keys.LEFT)) {
				ship.moveX(-speed);
			}
			// right
			if (Keys.isDown(Keys.RIGHT)) {
				ship.moveX(speed);
			}
			// up
			if (Keys.isDown(Keys.UP)) {
				ship.moveY(-speed);
			}
			// down
			if (Keys.isDown(Keys.DOWN)) {
				ship.moveY(speed);
			}
		}
	}




	// handle frame 
	function onFrame(time) {
		
		var dtime = time - onFrame.oldTime;

		if (Keys.isPressed(Keys.SPACEBAR)) {
			ship.setColor(new RGBA());
		}

		handleMovement(dtime);
		
		Keys.update();
		requestAnimationFrame(onFrame);
	}
	// start frame handling
	onFrame.oldTime = (new Date()).getTime();
	requestAnimationFrame(onFrame);



</script>
</body>
</html>